## Kafka

고성능 분산 이벤트 스트리밍 플랫폼

- pub, sub 형태의 메시지 큐 형태로 동작
- 분산 환경에 특화

### 구성요소

#### Topic

- 각 메세지를 목적에 맞게 구분할 때 사용
- 메세지를 전송하거나 소비할 때 무조건 입력
- Consumer는 자신이 담당하는 Topic의 메세지를 처리
- 한 개의 토픽은 한 개 이상의 파티션으로 구성

#### Partition

- 분산처리를 위해 사용됨
- Topic생성 시 partition 개수를 지정할 수 있음 (partition 추가 가능)
- 파티션이 1개라면 모든 메세지의 순서가 보장됨
- 파티션 내부에서 각 메세지는 offset으로 구분됨
- 파티션이 여러개라면 kafka클러스터가 라운드 로빈 방식으로 분배해서 분산처리되기때문에 순서가 보장되지 않음
- 파티션이 많을 수록 처리량이 좋지만 장애 복구 시간이 늘어남

#### Offset

- 컨슈머에서 메세지를 어디까지 읽었는지 저장하는 값
- 컨슈머 그룹의 컨슈머들은 각각의 파티션에 자신이 가져간 메세지의 위치 정보를 기록
- 컨슈머 장애 발생 후 다시 살아나도 전에 마지막으로 읽었던 위치에서부터 다시 읽어들일 수 있음

#### Producer

- 메세지를 만들어서 카프카 클러스터에 전송
- 메세지전송 시 Batch 처리 가능
- key 값을 지정하여 특정 Partition으로만 전송이 가능함
- 전송 acks값을 설정하여 효율성을 높일 수 있음
- ACKS = 0 -> 매우 빠르게 전송, 파티션 리더가 받았는지 알 수 없음
- ACKS = 1 -> 리더가 받았는지 확인. 기본값
- ACKS = ALL -> 리더와 팔로워가 받았는지 확인

#### Consumer

- 카프카 클러스터에서 메세지를 읽어서 처리
- 메세지를 Batch로 읽어들일 수 있음
- 한개의 컨슈머는 여러 개의 토픽을 처리할 수 있음
- 메세지를 소비해도 메세지를 삭제하지는 않음
- 한번 저장된 메세지를 여러번 소비하는 것도 가능
- 컨슈머는 컨슈머 그룹에 속함
- 한개 파티션은 같은 컨슈머 그룹의 여러개의 컨슈머에서 연결할 수 없음

#### Broker

- 실행된 카프카 서버
- 프로듀서와 컨슈머는 별도의 애플리케이션으로 구성되는 반면, 브로커는 카프카 그자체
- 브로커는 카프카 클러스터 내부에 존재함
- 서버 내부에 메세지를 저장하고 관리하는 역할 수행

#### Zookeeper

- 분산 애플리케이션 관리를위한 코디네이터 시스템
- 분산 메세지 큐의 메타 정보를 중앙에서 관리하는 역할

#### 참고자료

[link](https://velog.io/@holicme7/Apache-Kafka-%EC%B9%B4%ED%94%84%EC%B9%B4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80)
