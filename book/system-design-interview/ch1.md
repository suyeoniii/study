## 사용자 수에 따른 규모 확장성

### 단일 서버

웹 앱, 데이터베이스, 캐시가 전부 한 대의 서버에서 실행

1. 사용자는 도메인으로 웹사이트 접속
   - 도메인 이름을 DNS에 질의하여 IP주소로 변환
2. DNS에서 조회한 IP 주소 = 웹 서버 주소
3. 해당 IP 주소로 HTTP 요청
4. 요청 받은 웹 서버는 HTML페이지나 JSON으로 응답 반환

### 데이터베이스

- 웹/모바일 트래픽 처리 용도, 데이터베이스용으로 각각 서버를 두어야함
- 웹 계층과 데이터 계층을 각각 독립적으로 확장할 수 있음
- 관계형 데이터베이스, 비관계형 데이터베이스를 사용할 수 있음

### 수직적 규모 확장 vs 수평적 규모 확장

#### 수직적 규모 확장 (스케일 업)

- 서버에 고사양 자원(CPU, RAM 등)을 추가하는 것
- 단순하다는 장점
- 확장에 한계가 있음
- 장애 시 자동복구, 다중화 방안이 지원되지 않음

#### 수평적 규모 확장 (스케일 아웃)

- 서버를 추가하여 성능을 개선하는 것
- 대규모 애플리케이션인 경우 더 적합함

#### 로드밸런서

- 웹 서버의 트래픽 부하를 고르게 분산하는 역할
- 보안을 위해 서버 간 통신에는 사설 IP 주소가 이용됨 (같은 네트워크에 속한 서버 사이 통신에만 쓰일 수 있음)
- 부하 분산 집합에 또 하나의 웹 서버를 추가하는 경우 장애를 자동복구하는 문제가 해소됨
- = 서버1이 다운되면 서버2로 트래픽이 전송되므로 전체가 다운되는 일이 방지됨
- 2대의 서버에서 더 늘려야 하는 경우에도 서버만 추가하면 로드밸런서가 트래픽을 자동으로 분산시켜줌

#### 데이터베이스 다중화

- 데이터베이스를 master, slave로 나누고 데이터 원본은 master에, slave에는 복사본을 저장하는 방식을 사용함
- master 데이터베이스에서만 쓰기 연산이 가능하고 slave 데이터베이스에서는 읽기 연산만 가능함
- 쓰기 작업은 master 데이터베이스로 전달되고, 읽기 작업은 slave 데이터베이스로 전달되어 부하가 분산됨
- 대부분 읽기 연산의 비중이 높기때문에 slave 데이터베이스의 수가 master보다 더 많음
- 데이터베이스 서버 중 일부의 데이터가 파괴되어도 여러 서버에 분산되어있기 때문에 데이터를 보존할 수 있음
- master 데이터베이스가 다운되어 slave 데이터베이스에서 쓰기 작업도 수행해야하는 경우, slave 데이터베이스에 있는 데이터가 최신 데이터가 아닐 수도 있다는 문제가 있음
- -> 복구 스크립트를 돌려서 해결할 수 있음. 그 외에 다중 마스터, 원형 다중화 등의 방식을 도입할 수도 있음

### 캐시

- 응답 시간 개선
- 자주 참조되는 데이터를 메모리 안에 두고, 뒤이은 요청이 보다 빨리 처리될 수 있도록 하는 저장소
- 캐시 계층은 데이터베이스보다 훨씬 빠름
- 웹 서버에서는 캐시 데이터 존재 여부를 먼저 확인하고, 없으면 DB를 조회하고 캐시에 씀 (읽기 주도형 캐시 전략)
- 데이터 갱신은 자주 일어나지 않지만, 참조는 빈번히 일어나는 경우 유리
- 캐시는 휘발성 메모리에 두므로 영속적으로 보관해야하는 데이터는 바람직하지 않음
- 만료 기간을 적절히 두어, 만료 시간이 길어 데이터가 너무 오래되거나, 만료 시간이 짧아 데이터베이스 읽기를 자주 해야하는 것을 피해야함
- 캐시 서버가 한 대인 경우 해당 서버는 SPOF(Single Point of Failure)이 될 수 있음 -> 분산하는 것이 바람직함
- LRU 정책 (마지막으로 사용된 시점이 가장 오래된 것)이 가장 자주 사용됨
