## 개략적인 규모 추정

개략적인 규모 추정을 위해서는 2의 제곱수, 응답지연 값, 가용성에 관계된 수치들을 기본적으로 잘 이해하고 있어야함

### 2의 제곱수

- 데이터 볼륨의 단위를 2의 제곱수로 표현하면 어떻게 되는지를 알아야함
- 예를 들어 1KB = 2^10, 1MB = 2^20, 1GB = 2^30, 1TB = 2^40, 1PB = 2^50, 1EB = 2^60
- 한글 및 다국어를 위해 4바이트로 계산하기

### 응답 지연 값

- L1 캐시 참조 = 0.5ns
- 분기 예측 오류 = 5ns
- L2 캐시 참조 = 7ns
- 뮤텍스 락/언락 = 100ns
- 주 메모리 참조 = 100ns
- Zippy로 1KB 전송 = 10,000ns
- 1 Gbps 네트워크로 2KB 전송 = 20,000ns
- 메모리에서 1MB 순차적으로 읽기 = 250,000ns
- 같은 데이터센터 내에서의 메시지 왕복 지연시간 = 500,000ns
- 디스크 탐색 = 10,000,000ns
- 네트워크에서 1MB 전송 = 10,000,000ns
- 디스크에서 1MB 읽기 = 30,000,000ns
- 한 패킷의 CA로부터 네덜란드까지 왕복 지연시간 = 150,000,000ns

Q. 이 수치들 알아야하나?

#### 이 수치들을 분석한 결론

- 메모리는 빠르지만, 디스크는 아직도 느리다
- 디스크 탐색은 가능한 피하기
- 단순한 압축 알고리즘은 빠르다
- 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라 (카프카에 데이터 전송 시 message 압축)
- 데이터 센터는 보통 여러 지역에 분산괴어있고, 센터들 간에 데이터를 주고 받는데는 시간이 걸린다

### 가용성에 관계된 수치들

- `고가용성`은 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력을 지칭하는 용어
- 고가용성은 퍼센트로 표현
- 100%는 시스템이 한번도 중단된 적이 없었음을 의미
- 99.999%는 시스템의 연간 장애 시간이 5.26분 이하

### 예제: 트위터 QPS와 저장소 요구량 추정

#### 가정

- MAU = 3억
- 50%의 MAU가 매일 활동
- 평균적으로 각 사용자는 매일 2건의 트윗을 작성
- 미디어를 포함하는 트윗은 10%로 가정
- 데이터는 5년간 보관

#### 추정

- QPS 추정장치

  - DAU = 3억 \* 50% = 1.5억
  - QPS = 1.5억 \* 2 / 24시간 / 3600초 = 약 3500
  - 최대 QPS = 2배 = 약 7000

- 저장소 요구량 추정
  - 평균 트윗 크기 = tweet_id + tweet_text + media_size = 64B + 140B + 1MB = 1.000064MB
  - 미디어 저장소 요구량 = 1.5억 \* 2 \* 10% \* 1MB = 30TB/일
  - 5년간 보관 = 30TB \* 365일 \* 5년 = 약 55PB

### Tip

- 정확한 값을 시간을 들여 계산하기보다는, 적절한 근사치를 활용하여 시간 정략하기
- 가정을 적어두고, 나중에 살펴볼 수 있게하기
- 단위 (unit)를 붙이기
- 많이 출제되는 개략적 규모 추정 문제
  - QPS
  - 최대 QPS
  - 저장소 요구량
  - 캐시 요구량
  - 서버 수
