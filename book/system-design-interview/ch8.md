## URL 단축기 설계

### 1. 문제 이해 및 설계 범위 확정

#### 기능

- URL 단축: 주어진 긴 URL을 짧게 줄인다
- URL 리디렉샨: 축약된 URL로 HTTP 요청이 오면 원래 URL로 안내
- 높은 가용성과 규모 확장성, 장애 감내

#### 개략적 추정

- 쓰기 연산: 매일 1억 개의 단축 URL 생성
- 생략

### 2. 개략적 설계안 제시 및 동의 구하기

#### API 엔드포인트

1. URL 단축
   - POST /api/v1/data/shorten
   - 반환: 단축 URL
2. URL 리다이렉션
   - GET /api/v1/shortUrl
   - 반환: HTTP 리다이렉션 목적지가 될 원래 URL

#### 리다이렉션

- `301 Permanently Moved`

  - 영구적으로 이전되었다는 응답
  - 브라우저는 이 응답을 캐시함
  - 첫번째 요청만 단축 URL서버로 전송되므로 서버 부하를 줄일 수 있음

- `302 Found`

  - 일시적으로 Location헤더가 지정하는 URL로 이동
  - 단축 URL 서버에 먼저 보내진 후, 원래 URL로 리다이렉션
  - 트래픽 분석이 중요한 경우 유리

- TODO: 307, 308

#### URL 단축

- 긴 URL에 대응되는 해시 함수를 찾는게 중요함

요구사항

- 주어진 긴 URL이 다른 값이면, 해시 값도 달라야함
- 계산된 해시 값은 원래 입력으로 주어졌던 긴 URL로 복원될 수 있어야함

### 3. 싱세 설계

- 해시 테이블의 경우 초기 전략으로는 괜찮으나, 실제 시스템으로 쓰기에는 메모리가 유한하고, 비싸서 좋지 않음
- 관계형 데이터베이스에 저장하는 방법이 있음
- 단축 URL, 원래 URL 순서쌍

#### 해시 함수

- URL을 해시 함수에 넣어 해시값을 얻음
- 길이가 7이면 3.5조개의 URL을 저장할 수 있음

#### 해시 후 충돌 해소

- CRC32, MD5, SHA-1 등의 해시 함수를 사용하는 방법이 있음
- 대부분 길이 7보다는 길기때문에, 길이를 줄여야하는데
  - 처음 7개 글자만 이용할 수 있음
  - 하지만 해시 결과가 충돌할 확률이 높아짐
  - 충돌이 해소 될 때까지 사전에 정한 문자열을 해시값에 덧붙임
  - 이 방법은 한번 이상 데이터베이스 질의를 해야하므로 오버헤드가 큼
  - 블룸 필터를 사용하면 성능을 높일 수 있음
  - TODO: 블룸 필터

#### base62 변환

- 62진법로 변환하여 저장

#### 두 접근법 비교

- 해시 후 충돌 해소 전략
  - 단축 URL 길이가 고정됨
  - 유일성이 보장되는 ID 생성기가 필요치 않음
  - 충돌이 가능해서 해소 전략이 필요
  - ID로부터 단축 URL을 계산하는 방식이 아니라서 다음에 쓸 수 있는 URL을 알아내는 것이 불가능
- base-62 변환

  - 단축 URL 길이가 가변적임, 값이 커지면 길이가 길어짐
  - 유일성이 보장되는 ID 생성기가 필요함
  - ID의 유일성이 보장된 후에야 저굥 가능한 전략이라 충돌은 아예 불가능
  - ID가 1씩 증가하는 값이라고 가정하면, 다음에 쓸 수 있는 URL을 알아내는 것이 가능함 (보안문제 방생 가능)

  #### URL 단축기 상세 설계

#### URL 리다이렉션 상세 설계

### 4. 마무리

- 처리율 제한 장치
- 웹 서버의 규모 확장
- 데이터베이스 규모 확장
- 데이터 분석 솔루션
