# 29장: 클린 임베디드 아키텍처

---

시간이 지나면 하드웨어, 펌웨어는 수명을 다해가지만, 소프트웨어는 계속 존재할 수 있다.
하지만 하드웨어, 펌웨어와의 의존성때문에 소프트웨어조차 하드웨어, 펌웨어와 같이 수명을 다하는 경우가 있다.

코드를 수정하기 어렵게 만드는 것은 펌웨어를 만들어 내는 것과 같다.
재사용되거나, 수정하기 쉽게 만들 수도 있는데 이를 포기하고 수정하기 어렵도록 코드를 작성하는 것을 지양해야한다.

### 앱-티튜드 테스트

동작여부를 확인하는 테스트이다.

1. 먼저 동작하게 만들어라.
2. 그리고 올바르게 만들어라.
3. 그리고 빠르게 만들어라.
   from 켄트백

동작하기만 하도록 만들 수도 있지만, 애플리케이션의 수명을 최대한 길게 가지기위해 동작여부를 넘어 코드, 구조를 개선해야한다.

### 타깃-하드웨어 병목현상

특정 하드웨어를 타깃으로 정한 경우, 테스트 환경이 해당 타깃으로 국한되고 타깃이 하나라면 테스트 가능한 유일한 장소이므로 병목현상이 발생할 수 있다.

### 클린 임베디드 아키텍처

- 하드웨어는 세부사항이다. 예를들어 소프트웨어는 저장소가 무엇인지에 상관없이 동작해야한다.
- 잘 설계된 소프트웨어는 타깃 하드웨어에 상관없이 동작해야한다.
- 클린 임베디드 아키텍처라면 하드웨어 장치에 직접 접근하는 코드는 펌웨어로만 한정시켜야한다.
- 운영체제는 세부사항이다. 소프트웨어는 운영체제에 의존하면 안된다.
  - OSAL(운영체제 추상화 계층)를 두어 OS에 직접 의존하는 대신 OSAL에 의존하도록 만들고, OS는 다른 OS로 쉽게 변경할 수 있어야한다.
- 관심사를 분리하고, 인터페이스에 의존하도록 하여 구현체는 바뀌어도 되도록 해야한다.
- 구현 세부사항은 언제든 변경될 수 있다고 생각해야한다. 세부사항이 적을 수록 변경 시 바꾸어야하는 코드도 적어진다.
- DRY 원칙(반복하지 말라)을 지켜야 한다. 수정 사항이 생겼을 때 훨씬 적은 부분만 수정하면 된다.

### 결론

코드를 재사용하기 어려운 펌웨어를 대량 생산하기보다 클린 임베디드 아키텍처를 지향하여 수명이 긴 소프트웨어를 작성하도록 해야한다.
