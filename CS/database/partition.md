## Partition

### Partition이란

Mysql에서 한 테이블을 여러 테이블로 분리하여 저장하여 관리하는 기능이다.
하지만 사용자입장에서는 한 테이블을 사용하는 것처럼 보이게된다.

**파티션을 사용하는 경우**

- 테이블이 너무 커서 인덱스 크기가 물리 메모리보다 큰 경우
- 주기적인 데이터 삭제 작업이 필요한 경우

### 특징

- 최댜 1024개의 파티션을 가질 수 있다.
- 파티션 테이블에서는 외래키 사용이 불가능하다.
- 파티션 테이블은 전문 검색 인덱스 생성 불가능
- 임시 테이블은 파티션 기능 사용 불가능
- 파티션 표현식에 사용할 수 있는 함수가 제한적이다.
  ```
  ABS(), CELING(), DAY(), DAYOFMONTH(), DAYOFWEEK(),
  DAYOFYEAR(), DATEDIFF(), EXTRACT(), FLOOR(), HOUR(),
  MICROSECOND(), MINUTE(), MOD(), MONTH(), QUARTER(),
  SECOND(), TIME_TO_SEC(), TO_DAYS(), WEEKDAY(), YEAR(), YEARWEEK()
  ```

### Partition 방법

#### Range

연속된 범위로 파티션 정의
주로 날짜 기반으로 데이터가 누적되고 수정, 삭제해야 할 경우 사용됨

- null은 지정할 수 없고, MAXVALUE 지정이 가능하다.

#### List

파티션 키 값이 카테고리와 같은 고정 값인 경우
키 값이 연속적이지 않을 경우
파티션 키 값이 검색 조건에 자주 사용될 때 유리하다.

- null 지정이 가능하다. MAXVALUE 지정은 불가능하다.

#### Hash

Hash 함수에 의해 파티션이 결정된다. Range, List에 의해 나누는게 어려울 때 사용된다.

#### Key

해시 파티션과 유사하다. 해시값을 구한 뒤, MOD를 적용하여 파티션을 결정한다.

### Index

그럼 index는 테이블 하나당 1개만 존재할까, 아니면 파티션별로 존재할까?
파티션 별로 저장된다. mysql에서 인덱스는 로컬 인덱스에 해당된다. 테이블 단위의 글로벌 인덱스는 사용하지 않는다.

**인덱스 스캔**
여러 파티션에 대해 인덱스 스캔을 수행할 때 파티션에서 조건에 일치하는 레코드를 가져와서 우선순위 큐에 임시로 저장한다.
우선순위 큐에서 다시 인덱스 정렬 순서대로 데이터를 가져간다.

### Partition Pruning

옵티마이저가 일부의 파티션만 읽어도 된다고 판단하면, 불필요한 파티션에는 접근하지 않는다.

#### 참고자료

https://velog.io/@gillog/MySQL-Partition
https://gngsn.tistory.com/203
