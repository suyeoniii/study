## 교착상태 (Deadlock)

### 교착상태란

다른 트랜잭션이 잠금(Lock)을 걸고 다른 잠근된 자원을 요청할때 무한히 대기하는 상태

### 해결 방안

**예방**

- 트랜잭션 실행전 사용할 모든 자원을 잠금
- SET LOCK_TIMEOUT을 통해 일정 시간이 지나면 요청을 취소

**회피**

- `Wait-Die` 자원을 점유하고 있는 트랜잭션보다 먼저 들어온 트랜잭션인 경우 wait, 늦게 들어온 트랜잭션인 경우 die
- `Wound-Wait` 자원을 점유하고 있는 트랜잭션보다 먼저 들어온 트랜잭션인 경우 선점(wound), 늦게 들어온 트랜잭션인 경우 wait

**낙관전 병행 제어 기법**

- 트랜잭션 수행중에는 확인하지 않고, 커밋 후 검사하여 문제가 있을 시 롤백하는 방법

### 발생 빈도 줄이기

- 트랜잭션을 자주 커밋한다. 한 트랜잭션이 너무 길지않도록
- 정해진 순서대로 테이블에 접근한다. 테이블 A -> 테이블 B
- 읽기 잠금 (SELECT ~ FOR UPDATE) 사용 지양
- 테이블 단위로 Lock을 획득한다.
- 인덱스 사용 (update시 index를 타지 않으면 전체 행에 Lock이 걸릴 수 있다.)
- 격리수준을 낮추는 것을 고려해볼 수 있다.

#### 참고자료

https://jaehoney.tistory.com/162
